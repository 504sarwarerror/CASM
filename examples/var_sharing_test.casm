%extern stdio.h

; Test variable sharing between CASM and C code
%var number 42
%var result 0
%var multiplier 3

%println "=== Variable Sharing Test ==="
%println "Initial CASM variables:"
%println "number = 42"
%println "multiplier = 3"
%println ""

; C code can access CASM variables via extern declarations
%println "C code processing variables..."
%! 
    %! printf("C sees number = %d\n", var_number);
    %! printf("C sees multiplier = %d\n", var_multiplier);
    
    // Perform calculation in C
    %! int calculation = var_number * var_multiplier;
    %! printf("C calculation: %d * %d = %d\n", var_number, var_multiplier, calculation);
    
    %! var_result = calculation;
    %! printf("C stored result in var_result = %d\n", var_result);

%println ""
%println "Back in CASM, checking the result:"

; CASM can now use the result calculated by C
%if result > 100
    %println "Result is greater than 100!"
    %println "C code successfully modified CASM variables"
%else
    %println "Result is 100 or less"
%endif

%println ""
%println "Final values:"
%println "number:"
%println number
%println "multiplier:" 
%println multiplier
%println "result (calculated by C):"
%println result

%println ""
%println "=== Test Complete ===">